<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tabular Recipe Notation Demo</title>
    <style>
      body {
        font-family: "Helvetica Neue", Arial, sans-serif;
        margin: 24px;
        background: #f6f7fb;
        color: #1d1d1f;
      }

      h1 {
        margin-bottom: 6px;
      }

      p {
        margin-top: 0;
        max-width: 900px;
      }

      .layout {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 24px;
        align-items: start;
      }

      textarea {
        width: 100%;
        min-height: 420px;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #cfd3dd;
        font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
        font-size: 0.9rem;
        background: #fff;
      }

      .panel {
        background: #ffffff;
        padding: 16px;
        border-radius: 12px;
        box-shadow: 0 6px 18px rgba(16, 24, 40, 0.08);
      }

      .status {
        margin-top: 12px;
        color: #b42318;
        font-weight: 600;
      }

      .controls {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-bottom: 12px;
      }

      select {
        padding: 8px 10px;
        border-radius: 8px;
        border: 1px solid #cfd3dd;
        font-size: 0.9rem;
        background: #fff;
      }

      .hint {
        font-size: 0.85rem;
        color: #667085;
        margin-top: 8px;
      }
    </style>
  </head>
  <body>
    <h1>Tabular Recipe Notation (TRN)</h1>
    <p>
      Paste recipe JSON on the left to render a TRN table. Each row lists a step or ingredient
      with dependencies represented by vertical, row-spanning action cells.
    </p>

    <div class="layout">
      <div class="panel">
        <div class="controls">
          <label for="sample-select"><strong>Sample Recipe</strong></label>
          <select id="sample-select"></select>
        </div>
        <label for="trn-input"><strong>TRN JSON Input</strong></label>
        <textarea id="trn-input" spellcheck="false"></textarea>
        <div class="hint">Update the JSON to experiment with different recipe flows.</div>
        <div class="status" id="status" aria-live="polite"></div>
      </div>
      <div class="panel">
        <trn-table id="trn-table"></trn-table>
      </div>
    </div>

    <script type="module" src="./trn-table.js"></script>
    <script type="module">
      const input = document.getElementById("trn-input");
      const status = document.getElementById("status");
      const table = document.getElementById("trn-table");
      const sampleSelect = document.getElementById("sample-select");

      const bananaNutBread = {
        title: "Banana Nut Bread",
        rows: [
          {
            cells: [
              {
                text: "Butter and flour a loaf pan",
                colspan: 7,
                align: "center",
                className: "instruction",
              },
            ],
          },
          {
            cells: [
              {
                text: "Preheat oven to 350°F (170°C)",
                colspan: 7,
                align: "center",
                className: "instruction",
              },
            ],
          },
          {
            cells: [
              { text: "2 large (250 g) ripe bananas" },
              { text: "mash" },
              { text: "mash until smooth", rowspan: 4, className: "vertical" },
              { text: "fold", rowspan: 10, className: "vertical" },
              { text: "bake 350°F (170°C) 55 min.", rowspan: 10, className: "vertical" },
              { text: "cool 10 min. in pan", rowspan: 10, className: "vertical" },
              { text: "cool on wire rack", rowspan: 10, className: "vertical" },
            ],
          },
          {
            cells: [
              { text: "6 Tbs. (90 mL) butter" },
              { text: "melt" },
            ],
          },
          {
            cells: [
              { text: "1 tsp. (5 mL) vanilla extract" },
              { text: "" },
            ],
          },
          {
            cells: [
              { text: "2 large eggs" },
              { text: "lightly beat" },
            ],
          },
          {
            cells: [
              { text: "1-1/3 cups (167 g) all-purpose flour" },
              { text: "whisk", rowspan: 5, className: "vertical" },
              { text: "", rowspan: 6, className: "righthide" },
            ],
          },
          {
            cells: [{ text: "2/3 cup (130 g) sugar" }],
          },
          {
            cells: [{ text: "1/2 tsp. (2.3 g) baking soda" }],
          },
          {
            cells: [{ text: "1/4 tsp. (1.2 g) baking powder" }],
          },
          {
            cells: [{ text: "1/2 tsp. (3 g) salt" }],
          },
          {
            cells: [
              { text: "1/2 cup (70 g) chopped walnuts" },
              { text: "", className: "righthide" },
            ],
          },
        ],
      };

      const lemonBars = {
        title: "Lemon Bars",
        rows: [
          {
            cells: [
              { text: "Preheat oven to 350°F (175°C)", colspan: 6, align: "center", className: "instruction" },
            ],
          },
          {
            cells: [
              { text: "8 Tbsp (113 g) butter" },
              { text: "soften" },
              { text: "cream", rowspan: 3, className: "vertical" },
              { text: "press into pan", rowspan: 4, className: "vertical" },
              { text: "bake crust 20 min.", rowspan: 4, className: "vertical" },
              { text: "cool", rowspan: 6, className: "vertical" },
            ],
          },
          {
            cells: [
              { text: "1/4 cup (50 g) sugar" },
              { text: "" },
            ],
          },
          {
            cells: [
              { text: "1 1/4 cups (160 g) flour" },
              { text: "mix in" },
            ],
          },
          {
            cells: [
              { text: "Pinch salt" },
              { text: "" },
            ],
          },
          {
            cells: [
              { text: "4 large eggs" },
              { text: "whisk", rowspan: 4, className: "vertical" },
              { text: "pour over crust", rowspan: 4, className: "vertical" },
              { text: "bake 20 min.", rowspan: 4, className: "vertical" },
              { text: "chill", rowspan: 4, className: "vertical" },
              { text: "slice", rowspan: 4, className: "vertical" },
            ],
          },
          {
            cells: [
              { text: "1 1/2 cups (300 g) sugar" },
              { text: "" },
            ],
          },
          {
            cells: [
              { text: "1/4 cup (32 g) flour" },
              { text: "" },
            ],
          },
          {
            cells: [
              { text: "1/2 cup (120 mL) lemon juice" },
              { text: "" },
            ],
          },
        ],
      };

      const tomatoPasta = {
        title: "Weeknight Tomato Pasta",
        rows: [
          {
            cells: [
              { text: "Bring salted water to a boil", colspan: 5, align: "center", className: "instruction" },
            ],
          },
          {
            cells: [
              { text: "8 oz (225 g) pasta" },
              { text: "boil", rowspan: 3, className: "vertical" },
              { text: "drain", rowspan: 3, className: "vertical" },
              { text: "toss with sauce", rowspan: 5, className: "vertical" },
              { text: "serve", rowspan: 5, className: "vertical" },
            ],
          },
          {
            cells: [
              { text: "1 Tbsp olive oil" },
              { text: "warm", rowspan: 4, className: "vertical" },
            ],
          },
          {
            cells: [
              { text: "2 cloves garlic" },
              { text: "sauté" },
            ],
          },
          {
            cells: [
              { text: "1 can (14 oz) crushed tomatoes" },
              { text: "simmer", rowspan: 2, className: "vertical" },
            ],
          },
          {
            cells: [
              { text: "Salt, pepper, basil" },
              { text: "" },
            ],
          },
        ],
      };

      const samples = {
        "Banana Nut Bread": bananaNutBread,
        "Lemon Bars": lemonBars,
        "Weeknight Tomato Pasta": tomatoPasta,
      };

      const updateTable = () => {
        status.textContent = "";
        try {
          const data = JSON.parse(input.value);
          table.data = data;
        } catch (error) {
          status.textContent = `Invalid JSON: ${error.message}`;
        }
      };

      Object.keys(samples).forEach((label) => {
        const option = document.createElement("option");
        option.value = label;
        option.textContent = label;
        sampleSelect.appendChild(option);
      });

      const loadSample = (label) => {
        const sample = samples[label];
        input.value = JSON.stringify(sample, null, 2);
        updateTable();
      };

      sampleSelect.addEventListener("change", (event) => {
        loadSample(event.target.value);
      });

      loadSample("Banana Nut Bread");
      updateTable();

      input.addEventListener("input", updateTable);
    </script>
  </body>
</html>
